<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ØªØ³Ø¹ÙŠØ± Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 30px; margin-bottom: 20px; }
        h1 { color: #333; margin-bottom: 10px; font-size: 28px; }
        h2 { color: #555; margin-bottom: 20px; font-size: 22px; }
        .subtitle { color: #666; font-size: 14px; margin-bottom: 20px; }
        .tabs { display: flex; gap: 0; background: white; border-radius: 12px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); flex-wrap: wrap; }
        .tab { padding: 15px 25px; cursor: pointer; background: white; border: none; font-weight: 600; color: #666; transition: all 0.3s; font-size: 15px; white-space: nowrap; }
        .tab:hover { background: #f5f5f5; }
        .tab.active { background: #667eea; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #444; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: border 0.3s; }
        input:focus, select:focus { outline: none; border-color: #667eea; }
        .btn { padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 15px; transition: all 0.3s; }
        .btn:hover { background: #5568d3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(102,126,234,0.3); }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; }
        .btn-danger:hover { background: #dc2626; }
        .result-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 12px; color: white; margin-top: 20px; }
        .result-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.2); }
        .result-item:last-child { border-bottom: none; }
        .result-label { font-weight: 500; }
        .result-value { font-weight: 700; font-size: 18px; }
        .proposal-card { background: #f9fafb; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea; margin-bottom: 15px; }
        .proposal-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
        .proposal-name { font-weight: 700; font-size: 18px; color: #333; }
        .proposal-meta { font-size: 13px; color: #666; margin-top: 5px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .stat-value { font-size: 32px; font-weight: 700; color: #667eea; margin: 10px 0; }
        .stat-label { font-size: 13px; color: #666; font-weight: 600; }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: 600; }
        .alert-warning { background: #fef3c7; border-left: 4px solid #f59e0b; color: #92400e; }
        .checkbox-label { display: flex; align-items: center; gap: 10px; margin: 10px 0; }
        input[type="checkbox"] { width: auto; }
        .login-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-box { background: white; padding: 40px; border-radius: 12px; max-width: 400px; width: 90%; }
        .header-flex { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .user-badge { background: #dbeafe; color: #1e40af; padding: 8px 16px; border-radius: 8px; font-size: 14px; font-weight: 600; }
        .admin-badge { background: #d1fae5; color: #065f46; padding: 8px 16px; border-radius: 8px; font-size: 14px; font-weight: 600; }
        @media (max-width: 768px) {
            .grid, .grid-2, .stats-grid { grid-template-columns: 1fr; }
            h1 { font-size: 22px; }
            .card { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="card">
            <div class="header-flex">
                <div>
                    <h1>ğŸ§® Ù†Ø¸Ø§Ù… ØªØ³Ø¹ÙŠØ± Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h1>
                    <p class="subtitle">Ù†Ø¸Ø§Ù… Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ ÙˆØ§Ù„ØªØ³Ø¹ÙŠØ±</p>
                </div>
                <div>
                    <span id="userDisplay"></span>
                    <button class="btn" id="adminBtn" onclick="showLogin()">ğŸ”’ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
                    <button class="btn btn-danger" id="logoutBtn" onclick="logout()" style="display:none">Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </div>

        <!-- Login Overlay -->
        <div class="login-overlay" id="loginOverlay" style="display:none">
            <div class="login-box">
                <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
                <input type="password" id="passwordInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="margin: 20px 0">
                <div style="display:flex; gap:10px">
                    <button class="btn" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
                    <button class="btn" onclick="hideLogin()" style="background:#999">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
                <p style="margin-top:15px; font-size:12px; color:#666">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: <code>admin123</code></p>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('calculator')">ğŸ“Š Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ³Ø¹ÙŠØ±</button>
            <button class="tab" onclick="showTab('proposals')">ğŸ“„ Ø§Ù„Ø¹Ø±ÙˆØ¶ (<span id="proposalCount">0</span>)</button>
            <button class="tab" id="dashboardTab" style="display:none" onclick="showTab('dashboard')">ğŸ“ˆ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
            <button class="tab" id="settingsTab" style="display:none" onclick="showTab('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>

        <!-- Calculator Tab -->
        <div class="tab-content active" id="calculator">
            <div class="grid">
                <div class="card">
                    <h2>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h2>
                    <div style="display:flex; flex-direction:column; gap:15px">
                        <div>
                            <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                            <input type="text" id="clientName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
                        </div>
                        <div>
                            <label>Ø­Ø¬Ù… Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ù…Ù„ÙŠÙˆÙ† Ø±ÙŠØ§Ù„)</label>
                            <input type="number" id="clientRevenue" placeholder="Ù…Ø«Ø§Ù„: 35" oninput="suggestHours()">
                        </div>
                        <div class="grid-2">
                            <div>
                                <label>Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·</label>
                                <select id="clientSector">
                                    <option>ØªØ¬Ø§Ø±ÙŠ</option>
                                    <option>ØµÙ†Ø§Ø¹ÙŠ</option>
                                    <option>Ø®Ø¯Ù…ÙŠ</option>
                                    <option>Ù…Ø§Ù„ÙŠ</option>
                                    <option>Ø£Ø®Ø±Ù‰</option>
                                </select>
                            </div>
                            <div>
                                <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯</label>
                                <select id="clientComplexity">
                                    <option>Ø¨Ø³ÙŠØ·</option>
                                    <option selected>Ù…ØªÙˆØ³Ø·</option>
                                    <option>Ù…Ø¹Ù‚Ø¯</option>
                                </select>
                            </div>
                        </div>
                        <div style="background:#eff6ff; padding:20px; border-radius:10px">
                            <h3 style="margin-bottom:15px; color:#1e40af">Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</h3>
                            <div class="grid-2">
                                <div>
                                    <label>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø´Ø±ÙŠÙƒ</label>
                                    <input type="number" id="partnerHours" value="0">
                                </div>
                                <div>
                                    <label>Ø³Ø§Ø¹Ø§Øª Ù…ÙˆØ¸Ù 1</label>
                                    <input type="number" id="emp1Hours" value="0">
                                </div>
                                <div>
                                    <label>Ø³Ø§Ø¹Ø§Øª Ù…ÙˆØ¸Ù 2</label>
                                    <input type="number" id="emp2Hours" value="0">
                                </div>
                                <div>
                                    <label>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
                                    <input type="number" id="totalHours" value="0" readonly style="background:#f3f4f6">
                                </div>
                            </div>
                        </div>
                        <label class="checkbox-label">
                            <input type="checkbox" id="hasCollaborators" onchange="toggleCollaborators()">
                            <span>ÙŠÙˆØ¬Ø¯ Ù…ØªØ¹Ø§ÙˆÙ†ÙŠÙ†</span>
                        </label>
                        <div id="collaboratorRate" style="display:none">
                            <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ØªØ¹Ø§ÙˆÙ†ÙŠÙ† (%)</label>
                            <input type="number" id="collabRate" value="20">
                        </div>
                        <label class="checkbox-label">
                            <input type="checkbox" id="hasCommission" onchange="toggleCommission()">
                            <span>ÙŠÙˆØ¬Ø¯ Ø¹Ù…ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø¹Ù…ÙŠÙ„</span>
                        </label>
                        <div id="commissionRate" style="display:none">
                            <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© (%)</label>
                            <input type="number" id="commRate" value="15">
                        </div>
                        <div>
                            <label>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù (%)</label>
                            <input type="number" id="targetMargin" value="35">
                        </div>
                        <button class="btn" onclick="calculate()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±</button>
                    </div>
                </div>
                <div class="card">
                    <h2>Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
                    <div id="results"></div>
                </div>
            </div>
        </div>

        <!-- Proposals Tab -->
        <div class="tab-content" id="proposals">
            <div class="card">
                <h2>Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©</h2>
                <div id="proposalsList"></div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content" id="dashboard">
            <div class="card">
                <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h2>
                <div class="stats-grid" id="dashboardStats"></div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <div class="card">
                <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ</h2>
                
                <div class="alert alert-warning">
                    <strong>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±</strong>
                    <div style="display:flex; gap:10px; margin-top:10px">
                        <input type="text" id="newPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                        <button class="btn" onclick="changePassword()">ØªØºÙŠÙŠØ±</button>
                    </div>
                </div>

                <h3 style="margin:25px 0 15px 0">Ø§Ù„Ø±ÙˆØ§ØªØ¨</h3>
                <div class="grid-2">
                    <div>
                        <label>Ø±Ø§ØªØ¨ Ù…ÙˆØ¸Ù 1 (Ø´Ù‡Ø±ÙŠ)</label>
                        <input type="number" id="emp1Salary" value="8000">
                    </div>
                    <div>
                        <label>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠØ© - Ù…ÙˆØ¸Ù 1</label>
                        <input type="number" id="emp1HoursYear" value="1400">
                    </div>
                    <div>
                        <label>Ø±Ø§ØªØ¨ Ù…ÙˆØ¸Ù 2 (Ø´Ù‡Ø±ÙŠ)</label>
                        <input type="number" id="emp2Salary" value="8000">
                    </div>
                    <div>
                        <label>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠØ© - Ù…ÙˆØ¸Ù 2</label>
                        <input type="number" id="emp2HoursYear" value="1400">
                    </div>
                </div>

                <div style="background:#eff6ff; padding:20px; border-radius:10px; margin:25px 0">
                    <h3 style="margin-bottom:15px">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙŠÙƒ</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="partnerEnabled" checked>
                        <span>Ø§Ø­ØªØ³Ø§Ø¨ ØªÙƒÙ„ÙØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø´Ø±ÙŠÙƒ</span>
                    </label>
                    <div class="grid-2" style="margin-top:15px">
                        <div>
                            <label>Ø§Ù„ØªÙƒÙ„ÙØ© (Ø±ÙŠØ§Ù„/Ø³Ø§Ø¹Ø©)</label>
                            <input type="number" id="partnerCost" value="500">
                        </div>
                        <div>
                            <label>Ù†Ø³Ø¨Ø© Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø´Ø±ÙŠÙƒ (%)</label>
                            <input type="number" id="partnerPercent" value="7">
                        </div>
                    </div>
                </div>

                <h3 style="margin:25px 0 15px 0">Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
                <div class="grid-2">
                    <div><label>Ù…Ù†Ø§ÙØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</label><input type="number" id="costBenefits" value="2000"></div>
                    <div><label>Ù‡Ø§ØªÙ</label><input type="number" id="costPhone" value="500"></div>
                    <div><label>ÙƒÙ‡Ø±Ø¨Ø§Ø¡</label><input type="number" id="costElec" value="800"></div>
                    <div><label>Ù…ÙŠØ§Ù‡</label><input type="number" id="costWater" value="300"></div>
                    <div><label>Ù…ØµØ§Ø±ÙŠÙ Ø­ÙƒÙˆÙ…ÙŠØ©</label><input type="number" id="costGov" value="1000"></div>
                    <div><label>Ø¶ÙŠØ§ÙØ©</label><input type="number" id="costHosp" value="500"></div>
                    <div><label>Ù…ÙˆØ§Ø¯ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠØ©</label><input type="number" id="costSupp" value="800"></div>
                    <div><label>Ù‚Ø±Ø·Ø§Ø³ÙŠØ©</label><input type="number" id="costStat" value="300"></div>
                    <div><label>Ù…ØªÙ†ÙˆØ¹Ø©</label><input type="number" id="costMisc" value="1000"></div>
                </div>

                <h3 style="margin:25px 0 15px 0">ØªÙƒØ§Ù„ÙŠÙ Ø£Ø®Ø±Ù‰</h3>
                <div class="grid-2">
                    <div><label>Ø¥ÙŠØ¬Ø§Ø± (Ù†ØµÙ Ø³Ù†ÙˆÙŠ)</label><input type="number" id="costRent" value="60000"></div>
                    <div><label>Ø¨Ø±Ø§Ù…Ø¬ (Ø³Ù†ÙˆÙŠ)</label><input type="number" id="costSoft" value="12000"></div>
                    <div><label>Ø±Ø®Øµ (Ø³Ù†ÙˆÙŠ)</label><input type="number" id="costLic" value="5000"></div>
                    <div><label>SOCPA (Ø³Ù†ÙˆÙŠ)</label><input type="number" id="costSOCPA" value="3000"></div>
                    <div><label>ØªØ³ÙˆÙŠÙ‚ (Ø³Ù†ÙˆÙŠ)</label><input type="number" id="costMark" value="10000"></div>
                    <div><label>Ø¥Ù‡Ù„Ø§Ùƒ (Ø´Ù‡Ø±ÙŠ)</label><input type="number" id="costDepr" value="1600"></div>
                </div>

                <button class="btn btn-success" onclick="saveSettings()" style="margin-top:25px">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>

                <div id="costSummary" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding:25px; border-radius:12px; margin-top:30px; color:white"></div>
            </div>
        </div>
    </div>

    <script>
        let isAdmin = false;
        let adminPassword = localStorage.getItem('adminPassword') || 'admin123';
        let employeeName = localStorage.getItem('employeeName') || '';
        let proposals = JSON.parse(localStorage.getItem('proposals') || '[]');
        
        // Initialize
        updateProposalCount();
        loadSettings();
        if (employeeName) document.getElementById('userDisplay').innerHTML = `<span class="user-badge">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${employeeName}</span>`;
        
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
            if (tab === 'proposals') loadProposals();
            if (tab === 'dashboard') loadDashboard();
            if (tab === 'settings') updateCostSummary();
        }
        
        function showLogin() {
            document.getElementById('loginOverlay').style.display = 'flex';
            document.getElementById('passwordInput').focus();
        }
        
        function hideLogin() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('passwordInput').value = '';
        }
        
        function login() {
            const pass = document.getElementById('passwordInput').value;
            if (pass === adminPassword) {
                isAdmin = true;
                hideLogin();
                document.getElementById('adminBtn').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'inline-block';
                document.getElementById('dashboardTab').style.display = 'block';
                document.getElementById('settingsTab').style.display = 'block';
                document.getElementById('userDisplay').innerHTML = '<span class="admin-badge">ğŸ‘‘ Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</span>';
                alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ“');
            } else {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!');
            }
        }
        
        function logout() {
            isAdmin = false;
            document.getElementById('adminBtn').style.display = 'inline-block';
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('dashboardTab').style.display = 'none';
            document.getElementById('settingsTab').style.display = 'none';
            if (employeeName) document.getElementById('userDisplay').innerHTML = `<span class="user-badge">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${employeeName}</span>`;
            showTab('calculator');
        }
        
        function toggleCollaborators() {
            document.getElementById('collaboratorRate').style.display = 
                document.getElementById('hasCollaborators').checked ? 'block' : 'none';
        }
        
        function toggleCommission() {
            document.getElementById('commissionRate').style.display = 
                document.getElementById('hasCommission').checked ? 'block' : 'none';
        }
        
        function suggestHours() {
            const rev = parseFloat(document.getElementById('clientRevenue').value) || 0;
            let total = rev <= 5 ? 50 : rev <= 10 ? 80 : rev <= 25 ? 120 : rev <= 50 ? 180 : rev <= 75 ? 240 : 300;
            const partnerPercent = parseFloat(document.getElementById('partnerPercent').value) || 7;
            const partner = Math.round(total * (partnerPercent / 100));
            const remaining = total - partner;
            const emp1 = Math.round(remaining * 0.55);
            const emp2 = remaining - emp1;
            
            document.getElementById('partnerHours').value = partner;
            document.getElementById('emp1Hours').value = emp1;
            document.getElementById('emp2Hours').value = emp2;
            updateTotalHours();
        }
        
        function updateTotalHours() {
            const p = parseFloat(document.getElementById('partnerHours').value) || 0;
            const e1 = parseFloat(document.getElementById('emp1Hours').value) || 0;
            const e2 = parseFloat(document.getElementById('emp2Hours').value) || 0;
            document.getElementById('totalHours').value = p + e1 + e2;
        }
        
        document.getElementById('partnerHours').addEventListener('input', updateTotalHours);
        document.getElementById('emp1Hours').addEventListener('input', updateTotalHours);
        document.getElementById('emp2Hours').addEventListener('input', updateTotalHours);
        
        function calculate() {
            const name = document.getElementById('clientName').value;
            const revenue = document.getElementById('clientRevenue').value;
            
            if (!name || !revenue) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ­Ø¬Ù… Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª');
                return;
            }
            
            // Get costs
            const emp1Sal = parseFloat(document.getElementById('emp1Salary').value) || 0;
            const emp2Sal = parseFloat(document.getElementById('emp2Salary').value) || 0;
            const emp1HY = parseFloat(document.getElementById('emp1HoursYear').value) || 1400;
            const emp2HY = parseFloat(document.getElementById('emp2HoursYear').value) || 1400;
            
            const monthly = 
                (parseFloat(document.getElementById('costBenefits').value) || 0) +
                (parseFloat(document.getElementById('costPhone').value) || 0) +
                (parseFloat(document.getElementById('costElec').value) || 0) +
                (parseFloat(document.getElementById('costWater').value) || 0) +
                (parseFloat(document.getElementById('costGov').value) || 0) +
                (parseFloat(document.getElementById('costHosp').value) || 0) +
                (parseFloat(document.getElementById('costSupp').value) || 0) +
                (parseFloat(document.getElementById('costStat').value) || 0) +
                (parseFloat(document.getElementById('costMisc').value) || 0) +
                (parseFloat(document.getElementById('costDepr').value) || 0) +
                ((parseFloat(document.getElementById('costRent').value) || 0) / 6) +
                (((parseFloat(document.getElementById('costSoft').value) || 0) +
                  (parseFloat(document.getElementById('costLic').value) || 0) +
                  (parseFloat(document.getElementById('costSOCPA').value) || 0) +
                  (parseFloat(document.getElementById('costMark').value) || 0)) / 12);
            
            const annual = monthly * 12;
            const overhead = annual / 2;
            
            const emp1Cost = ((emp1Sal * 12) + overhead) / emp1HY;
            const emp2Cost = ((emp2Sal * 12) + overhead) / emp2HY;
            const partnerCostPerHour = parseFloat(document.getElementById('partnerCost').value) || 500;
            
            // Get hours
            const partnerHours = parseFloat(document.getElementById('partnerHours').value) || 0;
            const emp1Hours = parseFloat(document.getElementById('emp1Hours').value) || 0;
            const emp2Hours = parseFloat(document.getElementById('emp2Hours').value) || 0;
            
            const partnerEnabled = document.getElementById('partnerEnabled').checked;
            const pCost = partnerEnabled ? partnerHours * partnerCostPerHour : 0;
            const e1Cost = emp1Hours * emp1Cost;
            const e2Cost = emp2Hours * emp2Cost;
            const hoursCost = pCost + e1Cost + e2Cost;
            
            const targetMargin = parseFloat(document.getElementById('targetMargin').value) || 35;
            const priceBeforeVar = hoursCost / (1 - targetMargin / 100);
            
            const hasCollab = document.getElementById('hasCollaborators').checked;
            const hasComm = document.getElementById('hasCommission').checked;
            const collabRate = parseFloat(document.getElementById('collabRate').value) || 0;
            const commRate = parseFloat(document.getElementById('commRate').value) || 0;
            
            const varRate = (hasCollab ? collabRate / 100 : 0) + (hasComm ? commRate / 100 : 0);
            const finalPrice = priceBeforeVar / (1 - varRate);
            
            const collabCost = hasCollab ? finalPrice * (collabRate / 100) : 0;
            const commCost = hasComm ? finalPrice * (commRate / 100) : 0;
            const totalCost = hoursCost + collabCost + commCost;
            const profit = finalPrice - totalCost;
            const profitMargin = (profit / finalPrice) * 100;
            
            // Display results
            document.getElementById('results').innerHTML = `
                <div class="result-box">
                    <h3 style="margin-bottom:20px; font-size:20px">ğŸ’° Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ³Ø¹ÙŠØ±</h3>
                    <div class="result-item">
                        <span class="result-label">ØªÙƒÙ„ÙØ© Ø§Ù„Ø³Ø§Ø¹Ø§Øª:</span>
                        <span class="result-value">${hoursCost.toFixed(0)} Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªØ¹Ø§ÙˆÙ†ÙŠÙ† (${collabRate}%):</span>
                        <span class="result-value">${collabCost.toFixed(0)} Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ØªÙƒÙ„ÙØ© Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª (${commRate}%):</span>
                        <span class="result-value">${commCost.toFixed(0)} Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="result-item" style="border-top:2px solid rgba(255,255,255,0.4); padding-top:15px; margin-top:10px">
                        <span class="result-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©:</span>
                        <span class="result-value" style="color:#fca5a5">${totalCost.toFixed(0)} Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="result-item" style="font-size:22px">
                        <span class="result-label">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ù‚ØªØ±Ø­:</span>
                        <span class="result-value" style="color:#86efac">${finalPrice.toFixed(0)} Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­:</span>
                        <span class="result-value">${profit.toFixed(0)} Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­:</span>
                        <span class="result-value">${profitMargin.toFixed(1)}%</span>
                    </div>
                </div>
                <button class="btn btn-success" onclick="saveProposal()" style="width:100%; margin-top:20px">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ø±Ø¶</button>
            `;
            
            // Store calculation
            window.lastCalculation = {
                name, revenue,
                sector: document.getElementById('clientSector').value,
                complexity: document.getElementById('clientComplexity').value,
                finalPrice, totalCost, profit, profitMargin,
                partnerHours, emp1Hours, emp2Hours,
                hasCollab, collabRate, hasComm, commRate
            };
        }
        
        function saveProposal() {
            if (!window.lastCalculation) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            if (!employeeName) {
                const name = prompt('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ:');
                if (!name) return;
                employeeName = name;
                localStorage.setItem('employeeName', name);
                document.getElementById('userDisplay').innerHTML = `<span class="user-badge">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${name}</span>`;
            }
            
            const proposal = {
                id: Date.now(),
                ...window.lastCalculation,
                createdBy: employeeName,
                date: new Date().toLocaleDateString('ar-SA'),
                status: 'Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©',
                competitorPrice: '',
                competitorName: '',
                rejectionReason: ''
            };
            
            proposals.push(proposal);
            localStorage.setItem('proposals', JSON.stringify(proposals));
            updateProposalCount();
            alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ù†Ø¬Ø§Ø­ âœ“');
        }
        
        function updateProposalCount() {
            document.getElementById('proposalCount').textContent = proposals.length;
        }
        
        function loadProposals() {
            if (proposals.length === 0) {
                document.getElementById('proposalsList').innerHTML = '<p style="text-align:center; color:#999; padding:50px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ù…Ø­ÙÙˆØ¸Ø©</p>';
                return;
            }
            
            let html = '';
            proposals.slice().reverse().forEach(p => {
                html += `
                    <div class="proposal-card">
                        <div class="proposal-header">
                            <div>
                                <div class="proposal-name">${p.name}</div>
                                <div class="proposal-meta">${p.revenue}Ù… - ${p.sector} - ${p.complexity}</div>
                                <div class="proposal-meta">Ø¨ÙˆØ§Ø³Ø·Ø©: ${p.createdBy} | ${p.date}</div>
                            </div>
                            ${isAdmin ? `<button class="btn btn-danger" onclick="deleteProposal(${p.id})">ğŸ—‘ï¸</button>` : ''}
                        </div>
                        <div class="grid-2">
                            <div style="background:#dbeafe; padding:15px; border-radius:8px">
                                <div style="font-size:12px; color:#1e40af">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶</div>
                                <div style="font-size:20px; font-weight:700; color:#1e40af">${p.finalPrice.toFixed(0)} Ø±.Ø³</div>
                            </div>
                            <div style="background:#fee2e2; padding:15px; border-radius:8px">
                                <div style="font-size:12px; color:#991b1b">Ø§Ù„ØªÙƒÙ„ÙØ©</div>
                                <div style="font-size:20px; font-weight:700; color:#991b1b">${p.totalCost.toFixed(0)} Ø±.Ø³</div>
                            </div>
                            <div style="background:#d1fae5; padding:15px; border-radius:8px">
                                <div style="font-size:12px; color:#065f46">Ø§Ù„Ø±Ø¨Ø­</div>
                                <div style="font-size:20px; font-weight:700; color:#065f46">${p.profit.toFixed(0)} Ø±.Ø³</div>
                            </div>
                            <div style="background:#e9d5ff; padding:15px; border-radius:8px">
                                <div style="font-size:12px; color:#581c87">Ø§Ù„Ù‡Ø§Ù…Ø´</div>
                                <div style="font-size:20px; font-weight:700; color:#581c87">${p.profitMargin.toFixed(1)}%</div>
                            </div>
                        </div>
                        <div class="grid-2" style="margin-top:15px">
                            <div>
                                <label style="font-size:12px">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                                <select onchange="updateProposal(${p.id}, 'status', this.value)" style="padding:8px; font-size:13px">
                                    <option ${p.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</option>
                                    <option ${p.status === 'Ù…Ù‚Ø¨ÙˆÙ„' ? 'selected' : ''}>Ù…Ù‚Ø¨ÙˆÙ„</option>
                                    <option ${p.status === 'Ù…Ø±ÙÙˆØ¶' ? 'selected' : ''}>Ù…Ø±ÙÙˆØ¶</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size:12px">Ø³Ø¹Ø± Ø§Ù„Ù…Ù†Ø§ÙØ³</label>
                                <input type="number" value="${p.competitorPrice}" onchange="updateProposal(${p.id}, 'competitorPrice', this.value)" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ" style="padding:8px; font-size:13px">
                            </div>
                        </div>
                        ${p.status === 'Ù…Ø±ÙÙˆØ¶' ? `
                            <div style="margin-top:10px">
                                <label style="font-size:12px">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶</label>
                                <select onchange="updateProposal(${p.id}, 'rejectionReason', this.value)" style="padding:8px; font-size:13px">
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¨Ø¨</option>
                                    <option ${p.rejectionReason === 'Ø§Ù„Ø³Ø¹Ø± Ù…Ø±ØªÙØ¹' ? 'selected' : ''}>Ø§Ù„Ø³Ø¹Ø± Ù…Ø±ØªÙØ¹</option>
                                    <option ${p.rejectionReason === 'Ø§Ø®ØªØ§Ø±ÙˆØ§ Ù…Ù†Ø§ÙØ³' ? 'selected' : ''}>Ø§Ø®ØªØ§Ø±ÙˆØ§ Ù…Ù†Ø§ÙØ³</option>
                                    <option ${p.rejectionReason === 'ØªØ£Ø¬ÙŠÙ„' ? 'selected' : ''}>ØªØ£Ø¬ÙŠÙ„</option>
                                    <option ${p.rejectionReason === 'Ø£Ø®Ø±Ù‰' ? 'selected' : ''}>Ø£Ø®Ø±Ù‰</option>
                                </select>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            document.getElementById('proposalsList').innerHTML = html;
        }
        
        function updateProposal(id, field, value) {
            const index = proposals.findIndex(p => p.id === id);
            if (index !== -1) {
                proposals[index][field] = value;
                localStorage.setItem('proposals', JSON.stringify(proposals));
                loadProposals();
            }
        }
        
        function deleteProposal(id) {
            if (!isAdmin) {
                alert('ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·!');
                return;
            }
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¹Ø±Ø¶ØŸ')) {
                proposals = proposals.filter(p => p.id !== id);
                localStorage.setItem('proposals', JSON.stringify(proposals));
                updateProposalCount();
                loadProposals();
            }
        }
        
        function loadDashboard() {
            const total = proposals.length;
            const accepted = proposals.filter(p => p.status === 'Ù…Ù‚Ø¨ÙˆÙ„').length;
            const rejected = proposals.filter(p => p.status === 'Ù…Ø±ÙÙˆØ¶').length;
            const pending = proposals.filter(p => p.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©').length;
            const winRate = total > 0 ? (accepted / total * 100).toFixed(1) : 0;
            const avgProfit = proposals.length > 0 ? (proposals.reduce((s, p) => s + p.profitMargin, 0) / proposals.length).toFixed(1) : 0;
            
            document.getElementById('dashboardStats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±ÙˆØ¶</div>
                    <div class="stat-value">${total}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù‚Ø¨ÙˆÙ„</div>
                    <div class="stat-value" style="color:#10b981">${winRate}%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ù…ØªÙˆØ³Ø· Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­</div>
                    <div class="stat-value" style="color:#f59e0b">${avgProfit}%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©</div>
                    <div class="stat-value" style="color:#10b981">${accepted}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©</div>
                    <div class="stat-value" style="color:#ef4444">${rejected}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</div>
                    <div class="stat-value" style="color:#f59e0b">${pending}</div>
                </div>
            `;
        }
        
        function loadSettings() {
            const saved = localStorage.getItem('settings');
            if (saved) {
                const settings = JSON.parse(saved);
                Object.keys(settings).forEach(key => {
                    const el = document.getElementById(key);
                    if (el) {
                        if (el.type === 'checkbox') el.checked = settings[key];
                        else el.value = settings[key];
                    }
                });
            }
        }
        
        function saveSettings() {
            const settings = {
                emp1Salary: document.getElementById('emp1Salary').value,
                emp2Salary: document.getElementById('emp2Salary').value,
                emp1HoursYear: document.getElementById('emp1HoursYear').value,
                emp2HoursYear: document.getElementById('emp2HoursYear').value,
                partnerEnabled: document.getElementById('partnerEnabled').checked,
                partnerCost: document.getElementById('partnerCost').value,
                partnerPercent: document.getElementById('partnerPercent').value,
                costBenefits: document.getElementById('costBenefits').value,
                costPhone: document.getElementById('costPhone').value,
                costElec: document.getElementById('costElec').value,
                costWater: document.getElementById('costWater').value,
                costGov: document.getElementById('costGov').value,
                costHosp: document.getElementById('costHosp').value,
                costSupp: document.getElementById('costSupp').value,
                costStat: document.getElementById('costStat').value,
                costMisc: document.getElementById('costMisc').value,
                costRent: document.getElementById('costRent').value,
                costSoft: document.getElementById('costSoft').value,
                costLic: document.getElementById('costLic').value,
                costSOCPA: document.getElementById('costSOCPA').value,
                costMark: document.getElementById('costMark').value,
                costDepr: document.getElementById('costDepr').value
            };
            
            localStorage.setItem('settings', JSON.stringify(settings));
            updateCostSummary();
            alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ“');
        }
        
        function updateCostSummary() {
            const emp1Sal = parseFloat(document.getElementById('emp1Salary').value) || 0;
            const emp2Sal = parseFloat(document.getElementById('emp2Salary').value) || 0;
            const emp1HY = parseFloat(document.getElementById('emp1HoursYear').value) || 1400;
            const emp2HY = parseFloat(document.getElementById('emp2HoursYear').value) || 1400;
            
            const monthly = 
                (parseFloat(document.getElementById('costBenefits').value) || 0) +
                (parseFloat(document.getElementById('costPhone').value) || 0) +
                (parseFloat(document.getElementById('costElec').value) || 0) +
                (parseFloat(document.getElementById('costWater').value) || 0) +
                (parseFloat(document.getElementById('costGov').value) || 0) +
                (parseFloat(document.getElementById('costHosp').value) || 0) +
                (parseFloat(document.getElementById('costSupp').value) || 0) +
                (parseFloat(document.getElementById('costStat').value) || 0) +
                (parseFloat(document.getElementById('costMisc').value) || 0) +
                (parseFloat(document.getElementById('costDepr').value) || 0) +
                ((parseFloat(document.getElementById('costRent').value) || 0) / 6) +
                (((parseFloat(document.getElementById('costSoft').value) || 0) +
                  (parseFloat(document.getElementById('costLic').value) || 0) +
                  (parseFloat(document.getElementById('costSOCPA').value) || 0) +
                  (parseFloat(document.getElementById('costMark').value) || 0)) / 12);
            
            const annual = monthly * 12;
            const overhead = annual / 2;
            const emp1Cost = ((emp1Sal * 12) + overhead) / emp1HY;
            const emp2Cost = ((emp2Sal * 12) + overhead) / emp2HY;
            
            document.getElementById('costSummary').innerHTML = `
                <h3 style="margin-bottom:20px; font-size:20px">ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ</h3>
                <div class="grid-2">
                    <div style="background:rgba(255,255,255,0.2); padding:20px; border-radius:10px">
                        <div style="font-size:14px; margin-bottom:5px">Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</div>
                        <div style="font-size:28px; font-weight:700">${monthly.toFixed(0)} Ø±ÙŠØ§Ù„</div>
                    </div>
                    <div style="background:rgba(255,255,255,0.2); padding:20px; border-radius:10px">
                        <div style="font-size:14px; margin-bottom:5px">Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø³Ù†ÙˆÙŠØ©</div>
                        <div style="font-size:28px; font-weight:700">${annual.toFixed(0)} Ø±ÙŠØ§Ù„</div>
                    </div>
                    <div style="background:rgba(255,255,255,0.2); padding:20px; border-radius:10px">
                        <div style="font-size:14px; margin-bottom:5px">ØªÙƒÙ„ÙØ© Ø³Ø§Ø¹Ø© Ù…ÙˆØ¸Ù 1</div>
                        <div style="font-size:28px; font-weight:700">${emp1Cost.toFixed(0)} Ø±ÙŠØ§Ù„</div>
                    </div>
                    <div style="background:rgba(255,255,255,0.2); padding:20px; border-radius:10px">
                        <div style="font-size:14px; margin-bottom:5px">ØªÙƒÙ„ÙØ© Ø³Ø§Ø¹Ø© Ù…ÙˆØ¸Ù 2</div>
                        <div style="font-size:28px; font-weight:700">${emp2Cost.toFixed(0)} Ø±ÙŠØ§Ù„</div>
                    </div>
                </div>
            `;
        }
        
        function changePassword() {
            const newPass = document.getElementById('newPassword').value;
            if (newPass && newPass.length >= 4) {
                localStorage.setItem('adminPassword', newPass);
                adminPassword = newPass;
                document.getElementById('newPassword').value = '';
                alert('ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­ âœ“');
            } else {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
            }
        }
        
        // Enter key login
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') login();
        });
    </script>
</body>
</html>
